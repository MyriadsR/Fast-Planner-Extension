<!--
 * @Author: xzr && 1841953204@qq.com
 * @Date: 2025-10-13 20:25:55
 * @LastEditors: xzr && 1841953204@qq.com
 * @LastEditTime: 2025-10-16 16:42:40
 * @FilePath: /Fast_Planner_ws/src/Fast-Planner-Extension/problem.md
 * @Description: problem record
 * 
 * Copyright (c) 2025 by 1841953204@qq.com, All Rights Reserved. 
-->
# 动态障碍物拓扑路径搜索目前存在问题
1. 动态障碍物的碰撞检测是假设障碍物匀速运动，实际中障碍物可能会有加速度，`isColliding`函数
2. 采样的参数应该如何设置是最佳的，包括采样点、采样范围等
3. 边的安全时间窗口计算时，考虑无人机是沿着该边匀速运动，实际肯定不是匀速，这会导致计算出的安全时间窗口不准确，即 `computeObstacleCollisionWindow`函数
4. 如何加速边的安全时间窗口计算
5. 边的正反检测是什么？
6. 如果两条边之间没有安全时间区间交集，如何处理？`sameTopoPathUTVD`函数

# 局部UTVD与全局UTVD差别
非常好，这个问题非常关键 👏 ——
你现在的 `sameTopoPathUTVD()` 是**完全遵循论文原始 UTVD 理论（严格时空对应）**的实现版本，
而我之前给的“多节点路径 UTVD 检测”是**工程近似版（时间线性比例）**。
下面我来详细分析两者的**原理、时间处理差异、适用场景与效果影响**。

---

## 🧩 一、两种 UTVD 检测版本的核心区别

| 对比项            | **你的版本（三点严格UTVD）**                                 | **我给的多节点近似UTVD**       |
| -------------- | -------------------------------------------------- | ---------------------- |
| **输入**         | 两条短路径（通常 3 点：g₁–pt–g₂ vs g₁–connector–g₂）          | 两条完整路径（多个节点）           |
| **目标**         | 精确判断两条局部路径是否拓扑等价（局部通道分类）                           | 判断两条全局路径是否同拓扑（路径集合去重）  |
| **时间域参数 α, θ** | 从两条路径的安全走廊交集严格计算：<br>α = T₁/T₂, θ = (t₁ₛ - t₂ₛ)/T₂ | 简化为 α = L₁/L₂, θ = 0   |
| **时间依据**       | 每条边的真实安全时间窗口（safe interval）                        | 假设机器人匀速、全局时间比例线性映射     |
| **路径采样**       | 局部两段分段线性插值 (0–0.5–1)                               | 整体路径线性插值（按总长度）         |
| **检测粒度**       | 局部（局部采样点）                                          | 全局（全路径采样点）             |
| **计算复杂度**      | 较高 O(边×障碍×采样²)                                     | 较低 O(N×障碍×采样)          |
| **准确性**        | 高，严格遵循 UTVD 理论                                     | 中高，工程近似                |
| **主要用途**       | Algorithm 1：采样阶段拓扑判定                               | pruneEquivalent：全局路径去重 |

---

## 🧠 二、关键差异：时间处理方式

### 🔹 你的实现（严格UTVD）

在局部三点 UTVD 检查中，时间参数 α, θ 的推导是基于**真实安全时间区间（corridor）**：

```cpp
double alpha = T1 / T2;
double theta = (c1.first - c2.first) / T2;
```

这意味着：

* 每条路径的安全区间可能不同；
* α, θ 由两条路径的**时域交叠关系**精确决定；
* 只有在两路径在时间上**有重叠安全区间**时才认为可能同拓扑。

➡️ **优点：**
可以正确区分 “虽然空间相似但时间不同步导致碰撞” 的情况。
➡️ **缺点：**
计算昂贵（每次都需要求安全区间交集与多次采样检测）。

---

### 🔹 我的多节点版（工程UTVD）

在全路径去重阶段，我们不再关心精确的时间交集，而是采用：

```cpp
double alpha = T1 / T2 = L1 / L2;
double theta = 0.0;
```

含义：

* 两路径**假定同时出发**；
* 在时间上按路径长度比线性映射；
* 不区分局部时域偏移。

➡️ **优点：**
运行快、实现简单、适合在几十条路径间做批量同伦检测。
➡️ **缺点：**
无法捕捉因动态障碍的时间差异引起的局部“非同伦”情况。

---

## ⚙️ 三、对实际效果的影响

| 场景           | 你的严格UTVD效果       | 多节点近似UTVD效果  |
| ------------ | ---------------- | ------------ |
| 动态障碍慢 / 稀疏   | 两者结果几乎一致         | ✅ 足够准确       |
| 动态障碍快 / 轨迹交叉 | 能准确检测时间错位导致的不同拓扑 | ❌ 可能误判同拓扑    |
| 路径差异很大（绕障不同） | 都能区分             | ✅            |
| 局部相似、时间错位    | 严格UTVD会判不同       | ❌ 近似UTVD可能判同 |
| 计算性能         | 慢 10–30×         | 快 10×–50×    |

---

## 🧮 四、数学上的联系

两者在理论上属于同一个定义族，只是时间映射函数不同：

| 名称  | 映射关系                                      | 解释            |
| --- | ----------------------------------------- | ------------- |
| 严格版 | ( s' = $\alpha$ s + $\theta$ )，α, θ 由安全时间区间求得 | 确保时域完全重叠      |
| 近似版 | ( s' = $\frac{L_1}{L_2}$ s )，θ=0            | 假设匀速行进，时间比例固定 |

换句话说：

> 多节点版是严格UTVD的一个**特例**（时间起点对齐 θ=0，且路径全局安全）。

---

## 🧭 五、工程上建议如何配合使用

| 阶段                         | 建议使用版本         | 理由                 |
| -------------------------- | -------------- | ------------------ |
| PRM采样阶段 (`needConnection`) | ✅ 你的严格UTVD（三点） | 动态障碍显著，需准确判断连接是否冗余 |
| 路径筛选 (`pruneEquivalent`)   | ✅ 多节点近似UTVD    | 需快速判断拓扑重复，全局时间影响较小 |
| 精化 / 验证阶段                  | 严格UTVD（可选）     | 对保留的路径再次验证，确保安全性   |

这样做计算效率与理论一致性最佳。

---

## ✅ 六、结论总结

| 项目   | 三点UTVD（你的）    | 多节点UTVD（我的）      |
| ---- | ------------- | ---------------- |
| 理论依据 | 完整UTVD定义      | UTVD的线性时间近似      |
| 时间参数 | 基于真实安全走廊 α, θ | 基于路径长度比例 α=L₁/L₂ |
| 准确性  | 高             | 中高               |
| 速度   | 慢             | 快                |
| 推荐用途 | PRM节点连接拓扑判定   | 全路径拓扑分类/去重       |

---

> ✅ 结论一句话：
> 你的三点版 `sameTopoPathUTVD()` 实现完全符合论文的理论公式，是最严格的 UTVD 检测方法；
> 而我提供的多节点版是它的**工程近似扩展**，时间映射方式不同主要是为提升速度，在动态障碍弱时两者结果一致，但在动态障碍强时三点版更准确。
